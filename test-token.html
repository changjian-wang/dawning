<!DOCTYPE html>
<html>
<head>
    <title>JWT Token 解析器</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        textarea { width: 100%; height: 150px; margin: 10px 0; }
        pre { background: #f4f4f4; padding: 15px; border-radius: 5px; }
        .error { color: red; }
        .success { color: green; }
    </style>
</head>
<body>
    <h1>JWT Token 解析器</h1>
    <p>从浏览器 localStorage 中获取 access_token，或者直接粘贴 token：</p>
    <textarea id="tokenInput" placeholder="粘贴 token 或点击下方按钮自动读取"></textarea>
    <br>
    <button onclick="loadFromLocalStorage()">从 localStorage 读取</button>
    <button onclick="parseToken()">解析 Token</button>
    <br><br>
    <div id="result"></div>

    <script>
        function loadFromLocalStorage() {
            const token = localStorage.getItem('access_token');
            if (token) {
                document.getElementById('tokenInput').value = token;
                document.getElementById('result').innerHTML = '<p class="success">✅ Token 已从 localStorage 加载</p>';
            } else {
                document.getElementById('result').innerHTML = '<p class="error">❌ localStorage 中没有找到 access_token</p>';
            }
        }

        function parseToken() {
            const token = document.getElementById('tokenInput').value.trim();
            const resultDiv = document.getElementById('result');

            if (!token) {
                resultDiv.innerHTML = '<p class="error">❌ 请输入 token</p>';
                return;
            }

            try {
                // JWT 格式: header.payload.signature
                const parts = token.split('.');
                if (parts.length !== 3) {
                    throw new Error('Invalid JWT format');
                }

                // 解析 payload (base64url 解码)
                const payload = JSON.parse(atob(parts[1].replace(/-/g, '+').replace(/_/g, '/')));
                
                resultDiv.innerHTML = `
                    <h2 class="success">✅ Token 解析成功</h2>
                    <h3>Payload 内容：</h3>
                    <pre>${JSON.stringify(payload, null, 2)}</pre>
                    <h3>关键信息：</h3>
                    <ul>
                        <li><strong>用户ID (sub):</strong> ${payload.sub || '未找到'}</li>
                        <li><strong>用户名 (preferred_username):</strong> ${payload.preferred_username || '未找到'}</li>
                        <li><strong>角色 (role):</strong> ${payload.role || '未找到'}</li>
                        <li><strong>过期时间 (exp):</strong> ${payload.exp ? new Date(payload.exp * 1000).toLocaleString() : '未找到'}</li>
                        <li><strong>颁发时间 (iat):</strong> ${payload.iat ? new Date(payload.iat * 1000).toLocaleString() : '未找到'}</li>
                    </ul>
                `;
            } catch (error) {
                resultDiv.innerHTML = `<p class="error">❌ 解析失败: ${error.message}</p>`;
            }
        }

        // 页面加载时自动尝试读取
        window.onload = function() {
            const token = localStorage.getItem('access_token');
            if (token) {
                document.getElementById('tokenInput').value = token;
                parseToken();
            }
        };
    </script>
</body>
</html>
